[init]
	defaultBranch = main
# User-specific configuration (name, email, signingkey) is sourced from ~/.gitconfig.local
# Run: ~/.local/bin/setup-git-config.sh to configure (available after provisioning)
[include]
	path = ~/.gitconfig.local
[commit]
	gpgsign = true
[core]
	editor = vim
[alias]
	co = switch
	wt  = worktree
	wta = worktree add
	wtl = worktree list

	# Create a new worktree + branch next to the repo:
	#   git wtn <new-branch> [base=main]
	# Creates: ../<repo>-wt/<new-branch> (slashes replaced with underscores)
	wtn = "!f() { \
		b=\"$1\"; base=\"${2:-main}\"; \
		[ -z \"$b\" ] && { echo \"usage: git wtn <new-branch> [base=main]\" >&2; exit 2; }; \
		root=\"$(git rev-parse --show-toplevel)\" || exit 1; \
		repo=\"$(basename \"$root\")\"; \
		parent=\"$(dirname \"$root\")\"; \
		wtroot=\"$parent/${repo}-wt\"; \
		safe=\"$(printf \"%s\" \"$b\" | tr \"/ :\" \"___\")\"; \
		dest=\"$wtroot/$safe\"; \
		mkdir -p \"$wtroot\" || exit 1; \
		git fetch --prune >/dev/null 2>&1 || true; \
		if git show-ref --verify --quiet \"refs/heads/$b\"; then \
			git worktree add \"$dest\" \"$b\"; \
		else \
			git worktree add \"$dest\" -b \"$b\" \"origin/$base\"; \
		fi; \
	}; f"
	# Interactive fixup commit using fzf
	fixup = "!f() { \
		SHA=$(git log --oneline --color=always -n 10 | fzf --no-sort --ansi --cycle --layout=reverse | awk '{print $1}'); \
		if [ -n \"$SHA\" ] && git rev-parse --verify \"$SHA\" >/dev/null 2>&1; then \
			git commit --fixup=\"$SHA\"; \
		fi; \
	}; f"
[pull]
	rebase = true
[rebase]
	autosquash = true
[filter "lfs"]
	required = true
	clean = git-lfs clean -- %f
	smudge = git-lfs smudge -- %f
	process = git-lfs filter-process
[safe]
	# Allow git operations in web server document root (often owned by www-data)
	directory = /var/www/html
[push]
	autoSetupRemote = true
	default = current
